[
  {
    "displayName": "High Response Time Alert",
    "conditions": [
      {
        "displayName": "Response Time > 15s",
        "conditionThreshold": {
          "filter": "metric.type=\"logging.googleapis.com/user/email_response_time\" resource.type=\"cloud_function\"",
          "aggregations": [
            {
              "alignmentPeriod": "300s",
              "perSeriesAligner": "ALIGN_PERCENTILE_95"
            }
          ],
          "comparison": "COMPARISON_GT",
          "thresholdValue": 15,
          "duration": "300s",
          "trigger": {
            "count": 1
          }
        }
      }
    ],
    "alertStrategy": {
      "autoClose": "1800s",
      "notificationRateLimit": {
        "period": "3600s"
      }
    },
    "combiner": "OR",
    "enabled": true,
    "severity": "WARNING"
  },
  {
    "displayName": "High Error Rate Alert",
    "conditions": [
      {
        "displayName": "Error Rate > 5%",
        "conditionThreshold": {
          "filter": "metric.type=\"cloudfunctions.googleapis.com/function/execution_count\" resource.type=\"cloud_function\" resource.labels.function_name=\"process-email\" metric.labels.status=\"error\"",
          "aggregations": [
            {
              "alignmentPeriod": "300s",
              "perSeriesAligner": "ALIGN_RATE"
            }
          ],
          "comparison": "COMPARISON_GT",
          "thresholdValue": 0.05,
          "duration": "300s",
          "trigger": {
            "count": 1
          }
        }
      }
    ],
    "alertStrategy": {
      "autoClose": "1800s",
      "notificationRateLimit": {
        "period": "3600s"
      }
    },
    "combiner": "OR",
    "enabled": true,
    "severity": "ERROR"
  },
  {
    "displayName": "Function Memory Usage Alert",
    "conditions": [
      {
        "displayName": "Memory Usage > 80%",
        "conditionThreshold": {
          "filter": "metric.type=\"cloudfunctions.googleapis.com/function/user_memory_bytes\" resource.type=\"cloud_function\" resource.labels.function_name=\"process-email\"",
          "aggregations": [
            {
              "alignmentPeriod": "300s",
              "perSeriesAligner": "ALIGN_PERCENTILE_95"
            }
          ],
          "comparison": "COMPARISON_GT",
          "thresholdValue": 0.8,
          "denominatorFilter": "metric.type=\"cloudfunctions.googleapis.com/function/memory_limit_bytes\" resource.type=\"cloud_function\" resource.labels.function_name=\"process-email\"",
          "denominatorAggregations": [
            {
              "alignmentPeriod": "300s",
              "perSeriesAligner": "ALIGN_MEAN"
            }
          ],
          "duration": "300s",
          "trigger": {
            "count": 1
          }
        }
      }
    ],
    "alertStrategy": {
      "autoClose": "1800s",
      "notificationRateLimit": {
        "period": "3600s"
      }
    },
    "combiner": "OR",
    "enabled": true,
    "severity": "WARNING"
  },
  {
    "displayName": "Low Success Rate Alert",
    "conditions": [
      {
        "displayName": "Success Rate < 90%",
        "conditionThreshold": {
          "filter": "metric.type=\"logging.googleapis.com/user/email_success_rate\" resource.type=\"cloud_function\"",
          "aggregations": [
            {
              "alignmentPeriod": "300s",
              "perSeriesAligner": "ALIGN_MEAN"
            }
          ],
          "comparison": "COMPARISON_LT",
          "thresholdValue": 90,
          "duration": "300s",
          "trigger": {
            "count": 1
          }
        }
      }
    ],
    "alertStrategy": {
      "autoClose": "1800s",
      "notificationRateLimit": {
        "period": "3600s"
      }
    },
    "combiner": "OR",
    "enabled": true,
    "severity": "WARNING"
  },
  {
    "displayName": "System Health Alert",
    "conditions": [
      {
        "displayName": "System Health < 0.8",
        "conditionThreshold": {
          "filter": "metric.type=\"logging.googleapis.com/user/system_health\" resource.type=\"cloud_function\"",
          "aggregations": [
            {
              "alignmentPeriod": "300s",
              "perSeriesAligner": "ALIGN_MEAN"
            }
          ],
          "comparison": "COMPARISON_LT",
          "thresholdValue": 0.8,
          "duration": "300s",
          "trigger": {
            "count": 1
          }
        }
      }
    ],
    "alertStrategy": {
      "autoClose": "1800s",
      "notificationRateLimit": {
        "period": "3600s"
      }
    },
    "combiner": "OR",
    "enabled": true,
    "severity": "ERROR"
  },
  {
    "displayName": "High API Latency Alert",
    "conditions": [
      {
        "displayName": "API Latency > 2s",
        "conditionThreshold": {
          "filter": "metric.type=\"serviceruntime.googleapis.com/api/request_latencies\" resource.type=\"consumed_api\"",
          "aggregations": [
            {
              "alignmentPeriod": "300s",
              "perSeriesAligner": "ALIGN_PERCENTILE_95"
            }
          ],
          "comparison": "COMPARISON_GT",
          "thresholdValue": 2000,
          "duration": "300s",
          "trigger": {
            "count": 1
          }
        }
      }
    ],
    "alertStrategy": {
      "autoClose": "1800s",
      "notificationRateLimit": {
        "period": "3600s"
      }
    },
    "combiner": "OR",
    "enabled": true,
    "severity": "WARNING"
  },
  {
    "displayName": "Pub/Sub Backlog Alert",
    "conditions": [
      {
        "displayName": "Unacknowledged Messages > 100",
        "conditionThreshold": {
          "filter": "metric.type=\"pubsub.googleapis.com/subscription/num_undelivered_messages\" resource.type=\"pubsub_subscription\" resource.labels.subscription_id=\"email-notifications-sub\"",
          "aggregations": [
            {
              "alignmentPeriod": "300s",
              "perSeriesAligner": "ALIGN_MEAN"
            }
          ],
          "comparison": "COMPARISON_GT",
          "thresholdValue": 100,
          "duration": "300s",
          "trigger": {
            "count": 1
          }
        }
      }
    ],
    "alertStrategy": {
      "autoClose": "1800s",
      "notificationRateLimit": {
        "period": "3600s"
      }
    },
    "combiner": "OR",
    "enabled": true,
    "severity": "WARNING"
  },
  {
    "displayName": "Function Cold Start Alert",
    "conditions": [
      {
        "displayName": "Cold Start > 2s",
        "conditionThreshold": {
          "filter": "metric.type=\"cloudfunctions.googleapis.com/function/execution_times\" resource.type=\"cloud_function\" resource.labels.function_name=\"process-email\" metric.labels.state=\"cold_start\"",
          "aggregations": [
            {
              "alignmentPeriod": "300s",
              "perSeriesAligner": "ALIGN_PERCENTILE_95"
            }
          ],
          "comparison": "COMPARISON_GT",
          "thresholdValue": 2000,
          "duration": "300s",
          "trigger": {
            "count": 1
          }
        }
      }
    ],
    "alertStrategy": {
      "autoClose": "1800s",
      "notificationRateLimit": {
        "period": "3600s"
      }
    },
    "combiner": "OR",
    "enabled": true,
    "severity": "WARNING"
  }
]
